# 不确定性推理

## 一、不确定性推理基础
### 1. **不确定性来源**
- **信息不完整**：数据缺失（如医疗诊断中症状未完全提供）
- **随机性**：事件不可预测（如金融市场波动、基因表达）
- **模糊性**：语义不精确（如自然语言中的“很快”、“高个子”）
- **经典问题**：垃圾邮件过滤、疾病诊断、历史文本作者鉴定等

### 2. **概率论基础**
- **概率公理**：

  - $\text{Pr}(U) = 1$（全集概率为1）
  - $\text{Pr}(A) \in [0, 1]$
  - $\text{Pr}(A \cup B) = \text{Pr}(A) + \text{Pr}(B) - \text{Pr}(A \cap B)$
- **条件概率**：

\[
\text{Pr}(B|A) = \frac{\text{Pr}(B \cap A)}{\text{Pr}(A)} \quad (\text{Pr}(A) > 0)
\]

- **全概率公式**（划分 $B_1,\dots,B_k$ 互斥且完备）：

\[
\text{Pr}(A) = \sum_{i=1}^{k} \text{Pr}(A|B_i) \text{Pr}(B_i)
\]

- **独立性**：
  - $A,B$ 独立：$\text{Pr}(A \cap B) = \text{Pr}(A) \cdot \text{Pr}(B)$
  - 条件独立（给定 $C$）：$\text{Pr}(A \cap B|C) = \text{Pr}(A|C) \cdot \text{Pr}(B|C)$

---

## 二、贝叶斯推理
### 1. **贝叶斯定理**

\[
\text{Pr}(Y|X) = \frac{\text{Pr}(X|Y) \text{Pr}(Y)}{\text{Pr}(X)}
\]

- **先验概率** $\text{Pr}(Y)$：观察前的初始信念
- **后验概率** $\text{Pr}(Y|X)$：观察 $X$ 后的更新信念
- **似然函数** $\text{Pr}(X|Y)$：给定 $Y$ 时 $X$ 出现的可能性

### 2. **关键应用**
- **疾病诊断**（假阳性问题）：
  - 已知：发病率 $\text{Pr}(\text{病}) = 0.001$，准确率 $\text{Pr}(\text{阳}|\text{病}) = 0.99$，误报率 $\text{Pr}(\text{阳}|\text{健}) = 0.05$
  - 计算：$\text{Pr}(\text{病}|\text{阳}) \approx 0.019$（低概率因发病率低）
- **垃圾邮件过滤**（Paul Graham 方法）：
  1. 统计单词在垃圾/正常邮件中的频率
  2. 计算联合概率：$P(\text{垃圾}|\text{词}_1,\dots,\text{词}_{15}) \propto \prod P(\text{词}_i|\text{垃圾}) P(\text{垃圾})$
  3. 设定阈值（如 $>0.9$）判定垃圾邮件
- **历史案例**：
  - **联邦党人文集**：通过词汇频率（如 "upon"）用贝叶斯推断作者（Madison vs. Hamilton）
  - **天蝎号核潜艇搜救**：贝叶斯搜索理论定位沉船位置

### 3. **频率学派 vs. 贝叶斯学派**
| **学派**       | **核心观点**                            | **优势**               | **劣势**               |
|----------------|----------------------------------------|------------------------|------------------------|
| 频率学派       | 概率=频率（大量重复试验）               | 客观，数据驱动         | 忽略先验知识           |
| 贝叶斯学派     | 概率=信念（先验+数据）                  | 融入经验，小样本有效   | 先验选择主观           |

---

## 三、贝叶斯网络（Bayesian Networks）
### 1. **基本结构**
- **有向无环图（DAG）**：
  - 节点：随机变量（如 $X_1,\dots,X_n$）
  - 边：条件依赖关系（箭头表示影响方向）
- **条件概率表（CPT）**：
  - 每个节点存储 $P(X_i | \text{Par}(X_i))$
  - 例：警报网络中的 $\text{Pr}(\text{Alarm} | \text{Burglary}, \text{Earthquake})$

### 2. **联合概率分解**

\[
\text{Pr}(X_1, \dots, X_n) = \prod_{i=1}^{n} \text{Pr}(X_i | \text{Par}(X_i))
\]

- **参数数量**：若变量有 $d$ 个取值，父节点数 $k$，则 CPT 大小为 $d^{k+1}$。
- **紧凑表示**：链式结构（如 $E \to C \to A \to B \to H$）将参数从指数级（$2^n-1$）降至线性级（$O(n)$）。

### 3. **条件独立性**
- **规则**：给定父节点，节点与所有非后代独立。
  - 例：$\text{Hospitalized}$ 在给定 $\text{Blood Vessel}$ 时独立于 $\text{Early Wake}, \text{Coffee}$。
- **D-分离**：通过图结构判断条件独立（如 $A \perp C \mid B$ 若所有 $A-C$ 路径被 $B$ 阻塞）。

### 4. **构建贝叶斯网络**
1. **选择变量顺序**：按因果关系排序（原因→结果）更紧凑。
   - *错误顺序*（如 $H \to B \to A \to C \to E$）导致复杂依赖。
2. **添加边**：仅保留直接因果依赖。
3. **指定 CPT**：基于数据或专家知识。

### 5. **经典案例：Alarm 网络**
- **变量**：入室盗窃（B）、地震（E）、警报（A）、邻居呼叫（J, M）
- **联合概率**：

\[
\text{Pr}(B,E,A,J,M) = P(J|A) P(M|A) P(A|B,E) P(B) P(E)
\]

- **参数**：仅需 10 个（显式表示需 31 个）。

---

## 四、贝叶斯网络推理
### 1. **推理任务**
- **输入**：证据 $E$（部分变量观测值）
- **输出**：查询变量 $X_k$ 的后验分布 $\text{Pr}(X_k | E)$
  - 例：$\text{Pr}(\text{Burglary}=\text{true} \mid \text{MaryCalls}=\text{true}, \text{JohnCalls}=\text{false})$

### 2. **推理方法**
| **方法**       | **原理**                               | **适用场景**         |
|----------------|----------------------------------------|----------------------|
| 精确推理       | 变量消元、求和-乘积算法                | 小规模网络           |
| 近似推理       | MCMC采样（如Gibbs采样）                | 大规模网络           |
| 信念传播       | 消息传递（Pearl算法）                  | 树状/低环网络        |

### 3. **计算优势**
- **条件独立性**：避免计算完整联合分布。
- **复杂度**：从 $O(2^n)$ 降至 $O(\text{网络直径})$。

---

## 五、应用场景
1. **医疗诊断**：症状→疾病概率推断（如流感预测）。
2. **垃圾邮件过滤**：朴素贝叶斯分类器（单词条件独立）。
3. **图像处理**：去噪、分割（马尔可夫随机场）。
4. **搜救任务**：贝叶斯搜索理论（天蝎号核潜艇定位）。
5. **自然语言处理**：词性标注、机器翻译。

---

## 六、关键公式总结
1. **贝叶斯定理**：

\[
\text{Pr}(Y|X) = \frac{\text{Pr}(X|Y) \text{Pr}(Y)}{\text{Pr}(X)}
\]

2. **全概率公式**：

\[
\text{Pr}(X) = \sum_{i} \text{Pr}(X|Y_i) \text{Pr}(Y_i)
\]

3. **联合概率分解（BN）**：

\[
\text{Pr}(X_1, \dots, X_n) = \prod_{i=1}^{n} \text{Pr}(X_i | \text{Par}(X_i))
\]

4. **条件独立（BN）**：

\[
X \perp Y \mid Z \iff \text{Pr}(X,Y|Z) = \text{Pr}(X|Z) \text{Pr}(Y|Z)
\]

---

## 七、重要概念对比
| **概念**          | **定义**                                                                 |
|--------------------|--------------------------------------------------------------------------|
| 先验概率           | 观察前的信念（$\text{Pr}(Y)$）                                          |
| 后验概率           | 观察后的更新信念（$\text{Pr}(Y\|X)$）                                   |
| 条件独立性         | 给定 $Z$ 时 $X$ 与 $Y$ 独立（信息不增加）                               |
| 频率学派 vs 贝叶斯 | 频率=客观重复 vs 贝叶斯=主观信念+数据                                   |
| 贝叶斯网络优势     | 紧凑表示、高效推理、直观因果建模                                        |

> **总结**：不确定性推理的核心是利用概率论量化随机性和模糊性，贝叶斯网络通过图结构与条件独立性实现高效表示和推理。实际应用中需平衡先验知识（专家经验）与数据驱动（统计学习），在医疗、金融、AI 等领域有广泛应用。